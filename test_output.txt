
[1m[46m RUN [49m[22m [36mv4.0.18 [39m[90m/home/captain/projects/openquests/engine[39m

[90mstdout[2m | test/boss.test.ts[2m > [22m[2mBoss Mechanics[2m > [22m[2mBoss Participation[2m > [22m[2mAttacking monsters_base adds player to participants
[22m[39mChecking boss participation for player [33m1[39m Boss: iron_behemoth
Adding participant [33m1[39m

[90mstdout[2m | test/boss.test.ts[2m > [22m[2mBoss Mechanics[2m > [22m[2mBoss Participation[2m > [22m[2mDuplicate participation prevented
[22m[39mChecking boss participation for player [33m1[39m Boss: iron_behemoth
Participant already exists [33m1[39m

 [31mâ¯[39m test/boss.test.ts [2m([22m[2m10 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[32m 16[2mms[22m[39m
       [32mâœ“[39m Boss spawns when roll is 20[32m 2[2mms[22m[39m
       [32mâœ“[39m Emits BOSS_APPEAR event[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m Boss does not spawn if active boss exists[39m[32m 4[2mms[22m[39m
       [32mâœ“[39m Boss does not spawn if roll is not 20[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m Attacking monsters_base adds player to participants[39m[32m 3[2mms[22m[39m
[31m       [31mÃ—[31m Duplicate participation prevented[39m[32m 3[2mms[22m[39m
       [32mâœ“[39m Resolution Fails - Requirements not met[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m Resolution Success - Requirements met[39m[32m 1[2mms[22m[39m
       [32mâœ“[39m Boss expires when day >= expiresOn[32m 0[2mms[22m[39m
       [32mâœ“[39m Boss does not expire before expiresOn[32m 0[2mms[22m[39m

[31mâ¯â¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Tests 4 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m test/boss.test.ts[2m > [22mBoss Mechanics[2m > [22mBoss Spawn Logic[2m > [22mBoss does not spawn if active boss exists
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'requirements')[39m
[36m [2mâ¯[22m resolveBossIfNeeded src/engine.ts:[2m204:36[22m[39m
    [90m202| [39m
    [90m203| [39m    [35mconst[39m hasEnoughPlayers [33m=[39m
    [90m204| [39m        players[33m.[39mlength [33m>=[39m bossRule[33m.[39mrequirements[33m.[39mminPlayers
    [90m   | [39m                                   [31m^[39m
    [90m205| [39m
    [90m206| [39m    [35mconst[39m hasRequiredClasses [33m=[39m [33mObject[39m[33m.[39m[34mentries[39m(
[90m [2mâ¯[22m processTick src/engine.ts:[2m534:5[22m[39m
[90m [2mâ¯[22m test/boss.test.ts:[2m126:34[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/4]â¯[22m[39m

[41m[1m FAIL [22m[49m test/boss.test.ts[2m > [22mBoss Mechanics[2m > [22mBoss Participation[2m > [22mAttacking monsters_base adds player to participants
[31m[1mAssertionError[22m: expected [] to include 1[39m
[36m [2mâ¯[22m test/boss.test.ts:[2m162:55[22m[39m
    [90m160| [39m            [35mconst[39m { newState } [33m=[39m [34mprocessTick[39m(state[33m,[39m actions)[33m;[39m
    [90m161| [39m
    [90m162| [39m            expect(newState.activeBoss?.participants).toContain(1); //â€¦
    [90m   | [39m                                                      [31m^[39m
    [90m163| [39m            expect(newState.players['1'].message).toContain("join the â€¦
    [90m164| [39m        })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/4]â¯[22m[39m

[41m[1m FAIL [22m[49m test/boss.test.ts[2m > [22mBoss Mechanics[2m > [22mBoss Participation[2m > [22mDuplicate participation prevented
[31m[1mAssertionError[22m: expected [] to deeply equal [ 1 ][39m

[32m- Expected[39m
[31m+ Received[39m

[32m- [[39m
[32m-   1,[39m
[32m- ][39m
[31m+ [][39m

[36m [2mâ¯[22m test/boss.test.ts:[2m180:55[22m[39m
    [90m178| [39m
    [90m179| [39m            [90m// Participants should still only have one '1'[39m
    [90m180| [39m            [34mexpect[39m(newState[33m.[39mactiveBoss[33m?.[39mparticipants)[33m.[39m[34mtoEqual[39m([[34m1[39m])[33m;[39m
    [90m   | [39m                                                      [31m^[39m
    [90m181| [39m            [34mexpect[39m(newState[33m.[39mactiveBoss[33m?.[39mparticipants[33m.[39mlength)[33m.[39m[34mtoBe[39m([34m1[39m)[33m;[39m
    [90m182| [39m        })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/4]â¯[22m[39m

[41m[1m FAIL [22m[49m test/boss.test.ts[2m > [22mBoss Mechanics[2m > [22mBoss Resolution[2m > [22mResolution Success - Requirements met
[31m[1mAssertionError[22m: expected 12 to be 21 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 21[39m
[31m+ 12[39m

[36m [2mâ¯[22m test/boss.test.ts:[2m267:37[22m[39m
    [90m265| [39m            [90m// 20 * 1.05 = 21.0 -> 21.[39m
    [90m266| [39m            [35mconst[39m p1 [33m=[39m newState[33m.[39mplayers[[32m'1'[39m][33m;[39m
    [90m267| [39m            [34mexpect[39m(p1[33m.[39mcharacter[33m.[39mxp)[33m.[39m[34mtoBe[39m([34m21[39m)[33m;[39m
    [90m   | [39m                                    [31m^[39m
    [90m268| [39m            [34mexpect[39m(p1[33m.[39mmessage)[33m.[39m[34mtoContain[39m([32m"Defeated The Great Eagle"[39m)[33m;[39m
    [90m269| [39m            [34mexpect[39m(p1[33m.[39mmeta[33m.[39mbossKilled)[33m.[39m[34mtoBe[39m([34m1[39m)[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/4]â¯[22m[39m


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m4 failed[39m[22m[2m | [22m[1m[32m6 passed[39m[22m[90m (10)[39m
[2m   Start at [22m 00:36:27
[2m   Duration [22m 258ms[2m (transform 79ms, setup 0ms, import 96ms, tests 16ms, environment 0ms)[22m

